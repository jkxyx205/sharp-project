(function(a){a.fn.nthTabs=function(k){var g=this;var f={allowClose:true,active:true,location:true,fadeIn:true,rollWidth:g.width()-120};var e=a.extend({},f,k);var j=[];var h=0;var i='<div class="page-tabs"><a href="#" class="roll-nav roll-nav-left"><span class="fa fa-angle-double-left"></span></a><div class="content-tabs"><div class="content-tabs-container"><ul class="nav nav-tabs"></ul></div></div><a href="#" class="roll-nav roll-nav-right"><span class="fa fa-angle-double-right"></span></a><div class="dropdown roll-nav right-nav-list"><a href="#" class="dropdown-toggle" data-toggle="dropdown"><span class="tab-down"></span></a><ul class="dropdown-menu"><li><a href="#" class="tab-location">\u5b9a\u4f4d\u5f53\u524d\u9009\u9879\u5361</a></li><li><a href="#" class="tab-close-current">\u5173\u95ed\u5f53\u524d\u9009\u9879\u5361</a></li><li role="separator" class="divider"></li><li><a href="#" class="tab-close-other">\u5173\u95ed\u5176\u4ed6\u9009\u9879\u5361</a></li><li><a href="#" class="tab-close-all">\u5173\u95ed\u5168\u90e8\u9009\u9879\u5361</a></li><li class="divider"></li><li class="scrollbar-outer tab-list-scrollbar"><div class="tab-list-container"><ul class="tab-list"></ul></div></li></ul></div></div><div class="tab-content"></div>';var d=function(){g.html(i);b.onWindowsResize().onTabClose().onTabRollLeft().onTabRollRight().onTabList().onTabCloseOpt().onTabCloseAll().onTabCloseOther().onLocationTab().onTabToggle();return c};var c={getAllTabWidth:function(){var l=0;g.find(".nav-tabs li").each(function(){l+=parseFloat(a(this).width())});return l},getMarginStep:function(){return e.rollWidth/2},getActiveId:function(){return g.find('li[class="active"]').find("a").attr("href").replace("#","")},getTabList:function(){var l=[];g.find(".nav-tabs li a").each(function(){l.push({id:a(this).attr("href"),title:a(this).children("span").html()})});return l},addTab:function(p){if(this.isExistsTab(p.id)){this.setActTab(p.id);return}var q=[];var s=p.active==undefined?e.active:p.active;var n=p.allowClose==undefined?e.allowClose:p.allowClose;var m=p.location==undefined?e.location:p.location;var l=p.fadeIn==undefined?e.fadeIn:p.fadeIn;var o=p.url==undefined?"":p.url;q.push('<li title="'+p.title+'" '+(n?"":"not-allow-close")+">");q.push('<a href="#'+p.id+'" data-toggle="tab">');q.push("<span>"+p.title+"</span>");q.push("</a>");n?q.push('<i class="icon nth-icon-close-mini tab-close"></i>'):"";q.push("</li>");g.find(".nav-tabs").append(q.join(""));var r=[];r.push('<div class="tab-pane '+(l?"animation-fade":"")+'" id="'+p.id+'" '+(n?"":"not-allow-close")+">");if(o.length>0){r.push('<iframe src="'+p.url+'" frameborder="0" name="iframe-'+h+'" class="nth-tabs-frame"></iframe>');h++}else{r.push('<div class="nth-tabs-content">'+p.content+"</div>")}r.push("</div>");g.find(".tab-content").append(r.join(""));s&&this.setActTab(p.id);m&&this.locationTab(p.id);return this},addTabs:function(m){for(var l in m){this.addTab(m[l])}return this},locationTab:function(n){n=n==undefined?c.getActiveId():n;n=n.indexOf("#")>-1?n:"#"+n;var o=g.find("[href='"+n+"']");var m=0;o.parent().prevAll().each(function(){m+=a(this).width()});var l=o.parent().parent().parent();if(m<=e.rollWidth){margin_left_total=40}else{margin_left_total=40-Math.floor(m/e.rollWidth)*e.rollWidth}l.css("margin-left",margin_left_total);return this},delTab:function(m){m=m==undefined?c.getActiveId():m;m=m.indexOf("#")>-1?m:"#"+m;var n=g.find("[href='"+m+"']");if(n.parent().attr("not-allow-close")!=undefined){return false}if(n.parent().attr("class")=="active"){var l=n.parent().next();var o=a(m).next();if(l.length<1){l=n.parent().prev();o=a(m).prev()}l.addClass("active");o.addClass("active")}n.parent().remove();a(m).remove();return this},delOtherTab:function(){g.find(".nav-tabs li").not('[class="active"]').not("[not-allow-close]").remove();g.find(".tab-content div.tab-pane").not("[not-allow-close]").not('[class$="active"]').remove();g.find(".content-tabs-container").css("margin-left",40);return this},delAllTab:function(){this.delOtherTab();this.delTab();return this},setActTab:function(l){l=l==undefined?c.getActiveId():l;l=l.indexOf("#")>-1?l:"#"+l;g.find(".active").removeClass("active");g.find("[href='"+l+"']").parent().addClass("active");g.find(l).addClass("active");return this},toggleTab:function(l){this.setActTab(l).locationTab(l);return this},isExistsTab:function(l){l=l.indexOf("#")>-1?l:"#"+l;return g.find(l).length>0},tabToggleHandler:function(l){j.tabToggleHandler=l}};var b={onWindowsResize:function(){a(window).resize(function(){e.rollWidth=g.width()-120});return this},onLocationTab:function(){g.on("click",".tab-location",function(){c.locationTab()});return this},onTabClose:function(){g.on("click",".tab-close",function(){var o=a(this).parent().find("a").attr("href");var r=g.find("[href='"+o+"']");if(r.parent().next().length==0){var m=0;r.parent().prevAll().each(function(){m+=a(this).width()});var q=r.parent().width();var p=40;var l=r.parent().parent().parent();if(m>e.rollWidth){var n=l.css("marginLeft").replace("px","");p=parseFloat(n)+q+40}l.css("margin-left",p)}c.delTab(o)});return this},onTabCloseOpt:function(){g.on("click",".tab-close-current",function(){c.delTab()});return this},onTabCloseOther:function(){g.on("click",".tab-close-other",function(){c.delOtherTab()});return this},onTabCloseAll:function(){g.on("click",".tab-close-all",function(){c.delAllTab()});return this},onTabRollLeft:function(){g.on("click",".roll-nav-left",function(){var l=a(this).parent().find(".content-tabs-container");var n;if(c.getAllTabWidth()<=e.rollWidth){n=40}else{var m=l.css("marginLeft").replace("px","");n=parseFloat(m)+c.getMarginStep()+40}l.css("margin-left",n>40?40:n)});return this},onTabRollRight:function(){g.on("click",".roll-nav-right",function(){if(c.getAllTabWidth()<=e.rollWidth){return false}var l=a(this).parent().find(".content-tabs-container");var m=l.css("marginLeft").replace("px","");var n=parseFloat(m)-c.getMarginStep();if(c.getAllTabWidth()-Math.abs(m)<=e.rollWidth){return false}l.css("margin-left",n)});return this},onTabList:function(){g.on("click",".right-nav-list",function(){var l=c.getTabList();var m=[];a.each(l,function(n,o){m.push('<li class="toggle-tab" data-id="'+o.id+'">'+o.title+"</li>")});g.find(".tab-list").html(m.join(""))});g.find(".tab-list-scrollbar").scrollbar();this.onTabListToggle();return this},onTabListToggle:function(){g.on("click",".toggle-tab",function(){var l=a(this).data("id");c.setActTab(l).locationTab(l)});g.on("click",".scroll-element",function(l){l.stopPropagation()});return this},onTabToggle:function(){g.on("click",".nav-tabs li",function(){var l=g.find(".nav-tabs li a[href='#"+c.getActiveId()+"'] span").text();j.hasOwnProperty("tabToggleHandler")&&j.tabToggleHandler({last:{tabId:c.getActiveId(),tabText:l},active:{tabId:a(this).find("a").attr("href").replace("#",""),tabText:a(this).find("a span").text()}})})}};return d()}})(jQuery);
