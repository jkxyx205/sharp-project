var CodeInput=function(){"use strict";function t(t){this.options=t,this.id=t.id,this.options.method=this.options.method?this.options.method:"local",this.containerDOM=document.getElementById(this.id),this.tableContainerDOM=this.containerDOM.querySelector(".code-input-table"),this.inputDOM=this.containerDOM.querySelector(".code-input"),this.dialogIconDOM=this.containerDOM.querySelector(".fa-list"),this.tableDOM=this.containerDOM.getElementsByTagName("table")[0],this.hideHeader=0===this.tableDOM.getElementsByTagName("thead").length;let e=this.tableBodyDOM=this.tableDOM.getElementsByTagName("tbody")[0];function i(){l((t=>{if(t.classList.contains("active"))return o(this,t),this.tableContainerDOM.style.display="none",!0}))}function s(t){l((e=>{if(e.dataset.code===t)return o(this,e),!0}))}function l(t){let i=e.getElementsByTagName("tr");for(let e of i)if(t(e))break}function o(t,e){t.inputDOM.value=e.dataset[t.options.input||"code"];for(let i in e.dataset)t.inputDOM.dataset[i]=e.dataset[i]}function n(t){for(let e in t.inputDOM.dataset)t.inputDOM.dataset[e]=""}function a(t){if(console.log("hasData = ",t),t){this.codeInputTableEmptyDOM.style.display="none";let t=!1;for(let e of this.tableBodyDOM.children)t||"none"===e.style.display?e.classList.remove("active"):(e.classList.add("active"),t=!0);this.tableContainerDOM.scrollTop=0}else l((t=>{t.classList.remove("active")})),this.codeInputTableEmptyDOM.style.display="block"}this.codeInputTableEmptyDOM=this.containerDOM.querySelector(".code-input-table-empty"),this.search=this.options.search?this.options.search.split(/,\s*/):["code"],this.options.value?"string"==typeof this.options.value?s.call(this,this.options.value):s.call(this,this.options.value.code):n(this),"local"===this.options.method&&(this.inputDOM.addEventListener("focus",(t=>{let e=document.createEvent("Event");e.initEvent("keyup",!0,!1),this.inputDOM.dispatchEvent(e)})),l((t=>{t.addEventListener("click",(t=>{o(this,t.target.parentElement)}))}))),this.options.reportId&&$(this.dialogIconDOM).dialogReportPicker({reportId:this.options.reportId,class:"container-search-dialog modal-lg",selectMode:"single",render:function(t){},ok:{label:"确定",success:(t,e)=>{console.log("success",t);let i={dataset:{...t}};o.call(this,this,i),e.$modal.modal("hide")}},hidden:function(){console.log("hidden")}}),this.inputDOM.addEventListener("keydown",(t=>{if(38===t.keyCode||40===t.keyCode){let e=40===t.keyCode;for(let t of this.tableBodyDOM.children)if(t.classList.contains("active")){t.classList.remove("active");let i=!1,s=t;for(;s=e?s.nextElementSibling:s.previousElementSibling,s||(i=!0,s=e?this.tableBodyDOM.firstElementChild:this.tableBodyDOM.lastElementChild),"none"===s.style.display;);s.classList.add("active");let l=30,o=200-l;i&&!e?this.tableContainerDOM.scrollTop=s.offsetTop:i&&e?this.tableContainerDOM.scrollTop=0:e&&s.offsetTop>=this.tableContainerDOM.scrollTop+o?this.tableContainerDOM.scrollTop=s.offsetTop-o:!e&&s.offsetTop<=this.tableContainerDOM.scrollTop+l&&(this.tableContainerDOM.scrollTop=s.offsetTop-(this.hideHeader?0:l));break}}else 13===t.keyCode?i.call(this):this.inputDOM.setAttribute("data-oldvalue",this.inputDOM.value)})),this.inputDOM.addEventListener("keyup",function(t,e=300){let i;return(...s)=>{clearTimeout(i),i=setTimeout((()=>{t.apply(this,s)}),e)}}((t=>{if(console.log("input value = ",t.target.value),(!t.target.value||t.target.value!==t.target.dataset.oldvalue)&&38!==t.keyCode&&40!==t.keyCode&&13!==t.keyCode)if("local"===this.options.method){l((t=>{t.style.display="table-row"}));let e=!1;t.target.value?l((i=>{let s=!1;for(let l of this.search)if(i.dataset[l].indexOf(t.target.value)>-1){e=!0,s=!0;break}s||(i.style.display="none")})):l((t=>{e=!0})),this.tableContainerDOM.style.display="block",a.call(this,e)}else t.target.value?(a.call(this,!1),function(t){for(;t.firstElementChild;)t.firstElementChild.remove()}(this.tableBodyDOM),$.get("/code-input/users",{code:t.target.value}).done((t=>{if(console.log("Data Loaded data: ",t),t.data.length>0)for(let e of t.data){const t=document.createElement("tr");for(let i in e){if(t.setAttribute("data-"+i,e[i]),"id"===i)continue;let s=document.createElement("td");s.appendChild(document.createTextNode(e[i])),t.appendChild(s)}t.addEventListener("click",(t=>{o(this,t.target.parentElement)})),this.tableBodyDOM.appendChild(t),a.call(this,!0)}this.tableContainerDOM.style.display="block"}))):this.tableContainerDOM.style.display="none"}))),this.inputDOM.addEventListener("blur",(t=>{console.log("input blur...");let e=function(){let t=[];return l((e=>{"none"!==e.style.display&&t.push(e)})),t}();1!==e.length&&"none"!==this.tableContainerDOM.style.display&&n(this),this.inputDOM.value&&1==e.length&&i.call(this),setTimeout((()=>{this.options.blur&&this.options.blur(this.getValue()),this.tableContainerDOM.style.display="none",this.inputDOM.value?this.getValue().id?this.inputDOM.classList.remove("is-invalid"):(console.log("invalid value"),this.inputDOM.classList.add("is-invalid")):this.inputDOM.classList.remove("is-invalid")}),50)}))}return t.prototype.getValue=function(){return{...this.inputDOM.dataset}},t}();
